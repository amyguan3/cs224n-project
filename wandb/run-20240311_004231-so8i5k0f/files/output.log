Load 8bit model...
Start training...
===================================BUG REPORT===================================
Welcome to bitsandbytes. For bug reports, please submit your error trace to: https://github.com/TimDettmers/bitsandbytes/issues
================================================================================
/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/peft/utils/other.py:145: FutureWarning: prepare_model_for_int8_training is deprecated and will be removed in a future version. Use prepare_model_for_kbit_training instead.
  warnings.warn(
  0%|                                                                                                     | 0/6 [00:00<?, ?it/s]
  0%|                                                                                                     | 0/6 [00:00<?, ?it/s]/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/torch/utils/checkpoint.py:460: UserWarning: torch.utils.checkpoint: please pass in use_reentrant=True or use_reentrant=False explicitly. The default value of use_reentrant will be updated to be False in the future. To maintain current behavior, pass use_reentrant=True. It is recommended that you use use_reentrant=False. Refer to docs for more details on the differences between the two variants.
  warnings.warn(
/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/bitsandbytes/autograd/_functions.py:298: UserWarning: MatMul8bitLt: inputs will be cast from torch.float32 to float16 during quantization
  warnings.warn(f"MatMul8bitLt: inputs will be cast from {A.dtype} to float16 during quantization")
`use_cache = True` is incompatible with gradient checkpointing. Setting `use_cache = False`...




100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 6/6 [01:52<00:00, 18.69s/it]
[33m[W 2024-03-11 00:44:34,080][39m Trial 0 failed with parameters: {'learning_rate': 0.00441044340887407, 'rank': 64} because of the following error: RepositoryNotFoundError('404 Client Error. (Request ID: Root=1-65ee53f2-72f84f452173ef5e612a25c2;02969fb7-040f-4a9a-86c3-d30da1bd35ef)\n\nRepository Not Found for url: https://huggingface.co/api/models/amyguan/large-tune-test.\nPlease make sure you specified the correct `repo_id` and `repo_type`.\nIf you are trying to access a private or gated repo, make sure you are authenticated.').
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 286, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 403 Client Error: Forbidden for url: https://huggingface.co/api/repos/create
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 3178, in create_repo
    hf_raise_for_status(r)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 333, in hf_raise_for_status
    raise HfHubHTTPError(str(e), response=response) from e
huggingface_hub.utils._errors.HfHubHTTPError: 403 Client Error: Forbidden for url: https://huggingface.co/api/repos/create (Request ID: Root=1-65ee53f2-39c1c5e268a842d30eecb2cb;8f8e79ae-7775-408f-9595-f6bba3caee63)
You don't have the rights to create a model under this namespace
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 286, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/api/models/amyguan/large-tune-test
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/home/amyzhou/cs224n-project/tune.py", line 105, in objective
    train_adapter(processor, data_collator, sd_qa, param_config)
  File "/home/amyzhou/cs224n-project/alignment_util.py", line 233, in train_adapter
    model.push_to_hub(peft_model_id)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/transformers/utils/hub.py", line 860, in push_to_hub
    repo_id = self._create_repo(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/transformers/utils/hub.py", line 676, in _create_repo
    url = create_repo(repo_id=repo_id, token=token, private=private, exist_ok=True)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 3186, in create_repo
    self.repo_info(repo_id=repo_id, repo_type=repo_type, token=token)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 2275, in repo_info
    return method(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 2085, in model_info
    hf_raise_for_status(r)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 323, in hf_raise_for_status
    raise RepositoryNotFoundError(message, response) from e
huggingface_hub.utils._errors.RepositoryNotFoundError: 404 Client Error. (Request ID: Root=1-65ee53f2-72f84f452173ef5e612a25c2;02969fb7-040f-4a9a-86c3-d30da1bd35ef)
Repository Not Found for url: https://huggingface.co/api/models/amyguan/large-tune-test.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
[33m[W 2024-03-11 00:44:34,091][39m Trial 0 failed with value None.
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 286, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 403 Client Error: Forbidden for url: https://huggingface.co/api/repos/create
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 3178, in create_repo
    hf_raise_for_status(r)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 333, in hf_raise_for_status
    raise HfHubHTTPError(str(e), response=response) from e
huggingface_hub.utils._errors.HfHubHTTPError: 403 Client Error: Forbidden for url: https://huggingface.co/api/repos/create (Request ID: Root=1-65ee53f2-39c1c5e268a842d30eecb2cb;8f8e79ae-7775-408f-9595-f6bba3caee63)
You don't have the rights to create a model under this namespace
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 286, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/api/models/amyguan/large-tune-test
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/home/amyzhou/cs224n-project/tune.py", line 167, in <module>
    main()
  File "/home/amyzhou/cs224n-project/tune.py", line 163, in main
    tune(sources, target)
  File "/home/amyzhou/cs224n-project/tune.py", line 136, in tune
    study.optimize(objective, n_trials=3)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/study.py", line 451, in optimize
    _optimize(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 66, in _optimize
    _optimize_sequential(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 163, in _optimize_sequential
    frozen_trial = _run_trial(study, func, catch)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 251, in _run_trial
    raise func_err
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/home/amyzhou/cs224n-project/tune.py", line 105, in objective
    train_adapter(processor, data_collator, sd_qa, param_config)
  File "/home/amyzhou/cs224n-project/alignment_util.py", line 233, in train_adapter
    model.push_to_hub(peft_model_id)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/transformers/utils/hub.py", line 860, in push_to_hub
    repo_id = self._create_repo(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/transformers/utils/hub.py", line 676, in _create_repo
    url = create_repo(repo_id=repo_id, token=token, private=private, exist_ok=True)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 3186, in create_repo
    self.repo_info(repo_id=repo_id, repo_type=repo_type, token=token)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 2275, in repo_info
    return method(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 2085, in model_info
    hf_raise_for_status(r)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 323, in hf_raise_for_status
    raise RepositoryNotFoundError(message, response) from e
huggingface_hub.utils._errors.RepositoryNotFoundError: 404 Client Error. (Request ID: Root=1-65ee53f2-72f84f452173ef5e612a25c2;02969fb7-040f-4a9a-86c3-d30da1bd35ef)
Repository Not Found for url: https://huggingface.co/api/models/amyguan/large-tune-test.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 286, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 403 Client Error: Forbidden for url: https://huggingface.co/api/repos/create
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 3178, in create_repo
    hf_raise_for_status(r)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 333, in hf_raise_for_status
    raise HfHubHTTPError(str(e), response=response) from e
huggingface_hub.utils._errors.HfHubHTTPError: 403 Client Error: Forbidden for url: https://huggingface.co/api/repos/create (Request ID: Root=1-65ee53f2-39c1c5e268a842d30eecb2cb;8f8e79ae-7775-408f-9595-f6bba3caee63)
You don't have the rights to create a model under this namespace
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 286, in hf_raise_for_status
    response.raise_for_status()
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/api/models/amyguan/large-tune-test
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/home/amyzhou/cs224n-project/tune.py", line 167, in <module>
    main()
  File "/home/amyzhou/cs224n-project/tune.py", line 163, in main
    tune(sources, target)
  File "/home/amyzhou/cs224n-project/tune.py", line 136, in tune
    study.optimize(objective, n_trials=3)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/study.py", line 451, in optimize
    _optimize(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 66, in _optimize
    _optimize_sequential(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 163, in _optimize_sequential
    frozen_trial = _run_trial(study, func, catch)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 251, in _run_trial
    raise func_err
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/optuna/study/_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "/home/amyzhou/cs224n-project/tune.py", line 105, in objective
    train_adapter(processor, data_collator, sd_qa, param_config)
  File "/home/amyzhou/cs224n-project/alignment_util.py", line 233, in train_adapter
    model.push_to_hub(peft_model_id)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/transformers/utils/hub.py", line 860, in push_to_hub
    repo_id = self._create_repo(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/transformers/utils/hub.py", line 676, in _create_repo
    url = create_repo(repo_id=repo_id, token=token, private=private, exist_ok=True)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 3186, in create_repo
    self.repo_info(repo_id=repo_id, repo_type=repo_type, token=token)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 2275, in repo_info
    return method(
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/hf_api.py", line 2085, in model_info
    hf_raise_for_status(r)
  File "/opt/conda/envs/cs224n-project-env/lib/python3.9/site-packages/huggingface_hub/utils/_errors.py", line 323, in hf_raise_for_status
    raise RepositoryNotFoundError(message, response) from e
huggingface_hub.utils._errors.RepositoryNotFoundError: 404 Client Error. (Request ID: Root=1-65ee53f2-72f84f452173ef5e612a25c2;02969fb7-040f-4a9a-86c3-d30da1bd35ef)
Repository Not Found for url: https://huggingface.co/api/models/amyguan/large-tune-test.
Please make sure you specified the correct `repo_id` and `repo_type`.
If you are trying to access a private or gated repo, make sure you are authenticated.
{'train_runtime': 112.1768, 'train_samples_per_second': 0.642, 'train_steps_per_second': 0.053, 'train_loss': 66.42872619628906, 'epoch': 3.0}
Done with training! Pushing to hub...